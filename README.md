# tiny-imagenet-lst

+ A command line tool to build lst file for TinyImageNet dataset
+ This code is modifying from [imagenethelper.py](https://github.com/amuLee/ImageNetBundle/blob/master/mx_imagenet_alexnet/pyimagesearch/utils/imagenethelper.py)

### Directory

```
tiny_imagenet_200
├─(lists)
├─(output)
├─(rec)
├─*test*
│  └─*images*
|     └─...(10000 files)
├─*train*
│  ├─n01443537
│  │  ├─*images*
|  |  |  └─... (500 files)
│  │  └─n01443537_boxes.txt*
│  └─... (200 directories)
│      ├─*images*
|      |  └─ ... (500 files)
│      └─..._boxes.txt*
├─*val*
│   ├─*images*
|   |  └─... (10000 files)
│   └─ val_annotations.txt
├─wnids.txt*
├─(word_name.txt)
└─words.txt
```

+ *: not used in preprocess
+ **: dataset
+ (): generated by preprocess

### Files

+ wnids.txt: save 2000 classes used in imagenet

```
n02124075
n04067472
n04540053
... (2000 lines)
```

+ words.txt: save all classes name in imagenet

```
n00001740	entity
n00001930	physical entity
n00002137	abstraction, abstract entity
... (82115 lines)
```

+ val_annotations.txt: validation annotations

```
val_0.JPEG	n03444034	0	32	44	62
val_1.JPEG	n04067472	52	55	57	59
val_2.JPEG	n04070727	4	0	60	55
... (347377 lines)
```

+ word_name.txt

```
0	goldfish, Carassius auratus
1	European fire salamander, Salamandra salamandra
2	bullfrog, Rana catesbeiana
... (200 lines)
```

### Usage

+ Change configs in `config/imagenet_alexnet_config.py`

```py
BASH_PATH = 'G:/tiny_imagenet_200'
MX_OUTPUT = 'G:/tiny_imagenet_200'
```

+ Build `.lst`

```bash
python3 build_imagenet.py
```

+ Build `.rec` for mxnet

```bash
# im2rec.py locates on Python36/Lib/site-packages/mxnet/tools/im2rec.py in windows.
# May be wrong destination directory, adjust it manually.
python3 im2rec.py lists/train.lst rec/train.rec --resize 256 --encoding {.jpg, .png} --quality 100
# python3 im2rec.py lists/train.lst rec/train.rec --resize 256 --encoding .jpg --quality 100 --num-thread 4
```

### Result

```
tiny_imagenet_200
├─lists
|  ├─test.lst
|  ├─train.lst
|  └─val.lst
├─output
|  └─imagenet_mean.json
├─rec
|  ├─test.idx
|  ├─test.rec
|  ├─train.idx
|  ├─train.rec
|  ├─val.idx
|  └─val.rec
└─word_name.txt
```

+ imagenet_mean.json

```json
{"R": 122.4969533718533, "G": 114.28899011501736, "B": 101.3641702094184}
```

+ *.lst

```
0	43051	G:/tiny_imagenet_200\train\n07873807\images\n07873807_185.JPEG
1	21130	G:/tiny_imagenet_200\train\n03837869\images\n03837869_214.JPEG
2	23171	G:/tiny_imagenet_200\train\n04179913\images\n04179913_240.JPEG
... (10000 lines)
```

### References

+ [amuLee/ImageNetBundle](https://github.com/amuLee/ImageNetBundle)
+ [deep learning for computer vision with python Practitioner Bundle 1.2.1](https://www.pyimagesearch.com/deep-learning-computer-vision-python-book/)
